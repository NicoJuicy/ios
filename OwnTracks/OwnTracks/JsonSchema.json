{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://owntracks.org/JsonSchema",
    "title": "OwnTracks JSON Schema",
    "description": "A definition of our messages",
    "type": "object",
    "properties": {
        "_type": {
            "description": "The type of the message",
            "type": "string",
            "enum": [
                "beacon",
                "card",
                "cmd",
                "configuration",
                "location",
                "lwt",
                "steps",
                "transition",
                "waypoint",
                "waypoints"
            ]
        },
        "action": {
            "description": "Action to be performed by the device",
            "type": "string",
            "enum": [ 
                "action",
                "clearWaypoints",
                "dump", 
                "reportLocation",
                "reportSteps",
                "response",
                "setConfiguration",
                "setWaypoints",
                "waypoints"
            ]
        },
        "face": {
            "description": "Base64 encoded PNG image that is displayed instead of the Tracker ID",
            "type": "string",
            "contentEncoding": "base64",
            "contentMediaType": "image/png"
        },
        "lat": {
            "description": "Latitude",
                "type": "number"
            },
            "lon": {
                "description": "Longitude",
                "type": "number"
            },
            "tst": {
                "description": "UNIX epoch timestamp in seconds of the location fix",
                "type": "integer"
            },
            "name": {
            "description": "Name to identify a user",
            "type": "string"
        },
        "content" : {
            "type" : "string",
            "contentMediaType": "text/html"
        },
        "url" : {
            "type" : "string"
        },
        "notification" : {
            "type" : "string"
        }
    },
    "allOf": [
        {
            "if" : {
                "properties" : {
                    "_type" : { "const" : "location" }
                },
                "required": [ "_type" ]
            },
            "then" : {
                "required" : [ "lat", "lon", "tst" ]
            }
        },
        {
            "if" : {
                "properties" : {
                    "_type" : { "const" : "card" }
                },
                "required": [ "_type" ]
            },
            "then" : {
                "required" : [ "face", "name" ]
            }
        },
        {
            "if" : {
                "properties" : {
                    "_type" : { "const" : "cmd" }
                },
                "required": [ "_type" ]
            },
            "then" : {
                "required" : [ "action" ]
            }
        },
        {
            "if" : {
                "properties" : {
                    "action" : { "const" : "action" }
                },
                "required": [ "action" ]
            },
            "then" : {
                "oneOf": [
                    {
                        "required" : [ "content" ]
                    },
                    {
                        "required" : [ "url" ]
                    },
                    {
                        "required" : [ "notification" ]
                    }
                ]
            }
        }
    ]
}
